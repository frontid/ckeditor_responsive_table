{"version":3,"sources":["table.js"],"names":["CKEDITOR","dialog","add","editor","$","jQuery","table","commitValue","data","id","info","getValue","buildTable","rows","cols","setHeader","dom","element","addClass","header","tr","k","th","append","i","$row","j","$col","moveCursorToCel","posX","posY","setTimeout","firstCell","cells","range","createRange","moveToPosition","POSITION_AFTER_START","select","updateHiddenHeaderLabels","_table","$table","columnTh","find","each","$th","columnIndex","index","$cols","attr","text","title","minWidth","minHeight","onLoad","setupContent","onShow","onOk","commitContent","parseInt","txtRows","txtCols","insertElement","on","e","el","getSelection","getStartElement","tagName","getParent","hasClass","contents","label","expand","padding","elements","type","required","setup","selectedElement","commit","selectedTable","buttons","okButton"],"mappings":";;AAAA;;;;;AAKAA,SAASC,MAAT,CAAgBC,GAAhB,CAAoB,cAApB,EAAoC,UAAUC,MAAV,EAAkB;AACpD,MAAIF,MAAJ;AACA,MAAIG,IAAIC,MAAR;AACA,MAAIC,KAAJ;;AAEA;;;;;;AAMA,MAAIC;AAAc,aAAdA,WAAc,CAAUC,IAAV,EAAgB;AAChC,UAAIC,KAAK,KAAKA,EAAd;;AAEA,UAAI,CAACD,KAAKE,IAAV,EAAgB;AACdF,aAAKE,IAAL,GAAY,EAAZ;AACD;;AAEDF,WAAKE,IAAL,CAAUD,EAAV,IAAgB,KAAKE,QAAL,EAAhB;AACD;;AARG;AAAA,KAAJ;;AAUA;;;;;;;;;AASA,WAASC,UAAT,CAAoBC,IAApB,EAA0BC,IAA1B,EAAgCC,SAAhC,EAA2C;AACzC,QAAIT,QAAQ,IAAIN,SAASgB,GAAT,CAAaC,OAAjB,CAAyB,OAAzB,CAAZ;AACAX,UAAMY,QAAN,CAAe,OAAf;AACAZ,UAAMY,QAAN,CAAe,qBAAf;AACAZ,UAAMY,QAAN,CAAe,iBAAf;;AAEA,QAAIH,cAAc,IAAlB,EAAwB;AACtB,UAAII,SAAS,IAAInB,SAASgB,GAAT,CAAaC,OAAjB,CAAyB,OAAzB,CAAb;AACA,UAAIG,KAAK,IAAIpB,SAASgB,GAAT,CAAaC,OAAjB,CAAyB,IAAzB,CAAT;;AAEA,WAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIP,IAApB,EAA0BO,GAA1B,EAA+B;AAC7B,YAAIC,KAAK,IAAItB,SAASgB,GAAT,CAAaC,OAAjB,CAAyB,IAAzB,CAAT;AACAG,WAAGG,MAAH,CAAUD,EAAV;AACD;;AAEDH,aAAOI,MAAP,CAAcH,EAAd;AACAd,YAAMiB,MAAN,CAAaJ,MAAb;AACD;;AAED,SAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIX,IAApB,EAA0BW,GAA1B,EAA+B;AAC7B,UAAIC,OAAO,IAAIzB,SAASgB,GAAT,CAAaC,OAAjB,CAAyB,IAAzB,CAAX;;AAEA,WAAK,IAAIS,IAAI,CAAb,EAAgBA,IAAIZ,IAApB,EAA0BY,GAA1B,EAA+B;AAC7B,YAAIC,OAAO,IAAI3B,SAASgB,GAAT,CAAaC,OAAjB,CAAyB,IAAzB,CAAX;AACAQ,aAAKF,MAAL,CAAYI,IAAZ;AACD;;AAEDrB,YAAMiB,MAAN,CAAaE,IAAb;AACD;;AAED,WAAOnB,KAAP;AACD;;AAED;;;;;;;AAOA,WAASsB,eAAT,CAAyBC,IAAzB,EAA+BC,IAA/B,EAAqCxB,KAArC,EAA4C;AAC1CyB,eAAW,YAAY;AACrB,UAAIC,YAAY,IAAIhC,SAASgB,GAAT,CAAaC,OAAjB,CAAyBX,MAAMF,CAAN,CAAQS,IAAR,CAAagB,IAAb,EAAmBI,KAAnB,CAAyBH,IAAzB,CAAzB,CAAhB;AACA,UAAII,QAAQ/B,OAAOgC,WAAP,EAAZ;AACAD,YAAME,cAAN,CAAqBJ,SAArB,EAAgChC,SAASqC,oBAAzC;AACAH,YAAMI,MAAN;AACD,KALD,EAKG,CALH;AAMD;;AAED;;;;;AAKA,WAASC,wBAAT,CAAkCC,MAAlC,EAA0C;AACxC,QAAIC,SAASrC,EAAEoC,OAAOpC,CAAT,CAAb;AACA,QAAIsC,WAAWD,OAAOE,IAAP,CAAY,UAAZ,CAAf;;AAEAD,aAASE,IAAT,CAAc,YAAY;AACxB,UAAIC,MAAMzC,EAAE,IAAF,CAAV;AACA,UAAI0C,cAAc1C,EAAE,IAAF,EAAQ2C,KAAR,KAAkB,CAApC;AACA,UAAIC,QAAQP,OAAOE,IAAP,CAAY,qBAAqBG,WAArB,GAAmC,GAA/C,CAAZ;;AAEAE,YAAMJ,IAAN,CAAW,YAAY;AACrB,YAAIjB,OAAOvB,EAAE,IAAF,CAAX;AACAuB,aAAKsB,IAAL,CAAU,YAAV,EAAwBJ,IAAIK,IAAJ,EAAxB;AACD,OAHD;AAKD,KAVD;AAYD;;AAED;AACA,SAAO;AACLC,WAAO,WADF;AAELC,cAAU,GAFL;AAGLC,eAAW,GAHN;;AAKLC;AAAQ,wBAAY;AAClBrD,iBAAS,IAAT;AACA,aAAKsD,YAAL;AACD;;AAHD;AAAA,OALK;;AAUL;;;AAGAC;AAAQ,wBAAY,CACnB;;AADD;AAAA,OAbK;;AAgBL;;;AAGAC;AAAM,sBAAY;AAChB,YAAIjD,OAAO,EAAX;AACA,aAAKkD,aAAL,CAAmBlD,IAAnB;AACA,YAAIE,OAAOF,KAAKE,IAAhB;AACA,YAAIG,OAAO8C,SAASjD,KAAKkD,OAAd,EAAuB,EAAvB,KAA8B,CAAzC;AACA,YAAI9C,OAAO6C,SAASjD,KAAKmD,OAAd,EAAuB,EAAvB,KAA8B,CAAzC;AACAvD,gBAAQM,WAAWC,IAAX,EAAiBC,IAAjB,EAAuBJ,KAAKK,SAA5B,CAAR;AACAZ,eAAO2D,aAAP,CAAqBxD,KAArB;AACAsB,wBAAgB,CAAhB,EAAmB,CAAnB,EAAsBtB,KAAtB;;AAGAH,eAAO4D,EAAP,CAAU,QAAV,EAAoB,UAAUC,CAAV,EAAa;AAC/B,cAAIC,KAAK9D,OAAO+D,YAAP,GAAsBC,eAAtB,EAAT;;AAEA,cAAIF,OAAO,IAAP,IAAeA,GAAG7D,CAAH,CAAKgE,OAAL,KAAiB,IAApC,EAA0C;AACxC,gBAAI5B,SAASyB,GAAGI,SAAH,GAAeA,SAAf,GAA2BA,SAA3B,EAAb;AACA,gBAAI7B,OAAO8B,QAAP,CAAgB,qBAAhB,CAAJ,EAA4C;AAC1C/B,uCAAyBC,MAAzB;AACD;AACF;AAEF,SAVD;AAWD;;AAtBD;AAAA,OAnBK;;AA2CL+B,cAAU,CACR;AACE9D,UAAI,MADN;AAEE+D,aAAO,EAFT;AAGErB,aAAO,EAHT;AAIEsB,cAAQ,IAJV;AAKEC,eAAS,CALX;AAMEC,gBAAU,CACR;AACEC,cAAM,MADR;AAEEnE,YAAI,SAFN;AAGE,mBAAW,CAHb;AAIE+D,eAAO,MAJT;AAKEK,kBAAU,IALZ;AAMEC;AAAO,yBAAUC,eAAV,EAA2B;AAChC;AACD;;AAFD;AAAA,WANF;AASEC,gBAAQzE;AATV,OADQ,EAWL;AACDqE,cAAM,MADL;AAEDnE,YAAI,SAFH;AAGD,mBAAW,CAHV;AAID+D,eAAO,SAJN;AAKDK,kBAAU,IALT;AAMDC;AAAO,yBAAUG,aAAV,EAAyB;AAC9B;AACD;;AAFD;AAAA,WANC;AASDD,gBAAQzE;AATP,OAXK,EAsBR;AACEqE,cAAM,UADR;AAEEnE,YAAI,WAFN;AAGE,mBAAW,CAHb;AAIE+D,eAAO,cAJT;AAKEK,kBAAU,KALZ;AAMEC;AAAO,yBAAUG,aAAV,EAAyB;AAC9B;AACD;;AAFD;AAAA,WANF;AASED,gBAAQzE;AATV,OAtBQ;AANZ,KADQ,CA3CL;AAsFL2E,aAAS,CAAClF,SAASC,MAAT,CAAgBkF,QAAjB;AAtFJ,GAAP;AAwFD,CA/LD","file":"table.js","sourcesContent":["/**\n * @file\n * Responsive table plugin.\n */\n\nCKEDITOR.dialog.add('table_dialog', function (editor) {\n  var dialog;\n  var $ = jQuery;\n  var table;\n\n  /**\n   * Stores the dialog user input into an accessible\n   * scope to allow access to the rest of the plugin.\n   *\n   * @param data\n   */\n  var commitValue = function (data) {\n    var id = this.id;\n\n    if (!data.info) {\n      data.info = {};\n    }\n\n    data.info[id] = this.getValue();\n  };\n\n  /**\n   * Generates the DOM table.\n   *\n   * @param {Number} rows\n   * @param {Number} cols\n   * @param setHeader\n   *\n   * @return {CKEDITOR.dom.element}\n   */\n  function buildTable(rows, cols, setHeader) {\n    var table = new CKEDITOR.dom.element(\"table\");\n    table.addClass('table');\n    table.addClass('ck-responsive-table');\n    table.addClass('cke_show_border');\n\n    if (setHeader === true) {\n      var header = new CKEDITOR.dom.element(\"thead\");\n      var tr = new CKEDITOR.dom.element(\"tr\");\n\n      for (var k = 0; k < cols; k++) {\n        var th = new CKEDITOR.dom.element(\"th\");\n        tr.append(th);\n      }\n\n      header.append(tr);\n      table.append(header);\n    }\n\n    for (var i = 0; i < rows; i++) {\n      var $row = new CKEDITOR.dom.element(\"tr\");\n\n      for (var j = 0; j < cols; j++) {\n        var $col = new CKEDITOR.dom.element(\"td\");\n        $row.append($col);\n      }\n\n      table.append($row);\n    }\n\n    return table;\n  }\n\n  /**\n   * @docme\n   *\n   * @param posX\n   * @param posY\n   * @param table\n   */\n  function moveCursorToCel(posX, posY, table) {\n    setTimeout(function () {\n      var firstCell = new CKEDITOR.dom.element(table.$.rows[posX].cells[posY]);\n      var range = editor.createRange();\n      range.moveToPosition(firstCell, CKEDITOR.POSITION_AFTER_START);\n      range.select();\n    }, 0);\n  }\n\n  /**\n   * @docme\n   *\n   * @param _table Ckeditor's table element.\n   */\n  function updateHiddenHeaderLabels(_table) {\n    var $table = $(_table.$);\n    var columnTh = $table.find(\"thead th\");\n\n    columnTh.each(function () {\n      var $th = $(this);\n      var columnIndex = $(this).index() + 1;\n      var $cols = $table.find('tr td:nth-child(' + columnIndex + ')');\n\n      $cols.each(function () {\n        var $col = $(this);\n        $col.attr('data-label', $th.text());\n      });\n\n    });\n\n  }\n\n  // Dialog.\n  return {\n    title: \"Add table\",\n    minWidth: 360,\n    minHeight: 320,\n\n    onLoad: function () {\n      dialog = this;\n      this.setupContent();\n    },\n\n    /**\n     * @todo remove this method.\n     */\n    onShow: function () {\n    },\n\n    /**\n     * When confirm the dialog.\n     */\n    onOk: function () {\n      var data = {};\n      this.commitContent(data);\n      var info = data.info;\n      var rows = parseInt(info.txtRows, 10) || 1;\n      var cols = parseInt(info.txtCols, 10) || 1;\n      table = buildTable(rows, cols, info.setHeader);\n      editor.insertElement(table);\n      moveCursorToCel(0, 0, table);\n\n\n      editor.on('change', function (e) {\n        var el = editor.getSelection().getStartElement();\n\n        if (el !== null && el.$.tagName === \"TH\") {\n          var _table = el.getParent().getParent().getParent();\n          if (_table.hasClass('ck-responsive-table')) {\n            updateHiddenHeaderLabels(_table);\n          }\n        }\n\n      });\n    },\n\n    contents: [\n      {\n        id: 'tab1',\n        label: '',\n        title: '',\n        expand: true,\n        padding: 0,\n        elements: [\n          {\n            type: 'text',\n            id: 'txtRows',\n            'default': 3,\n            label: \"Rows\",\n            required: true,\n            setup: function (selectedElement) {\n              // this.setValue(selectedElement.$.rows.length);\n            },\n            commit: commitValue\n          }, {\n            type: 'text',\n            id: 'txtCols',\n            'default': 2,\n            label: \"Columns\",\n            required: true,\n            setup: function (selectedTable) {\n              // this.setValue(tableColumns(selectedTable));\n            },\n            commit: commitValue\n          },\n          {\n            type: 'checkbox',\n            id: 'setHeader',\n            'default': 0,\n            label: \"Add a header\",\n            required: false,\n            setup: function (selectedTable) {\n              // this.setValue(tableColumns(selectedTable));\n            },\n            commit: commitValue\n          }\n        ]\n      }\n    ],\n    buttons: [CKEDITOR.dialog.okButton]\n  };\n});\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhYmxlLmpzIl0sIm5hbWVzIjpbIkNLRURJVE9SIiwiZGlhbG9nIiwiYWRkIiwiZWRpdG9yIiwiJCIsImpRdWVyeSIsInRhYmxlIiwiY29tbWl0VmFsdWUiLCJkYXRhIiwiaWQiLCJpbmZvIiwiZ2V0VmFsdWUiLCJidWlsZFRhYmxlIiwicm93cyIsImNvbHMiLCJzZXRIZWFkZXIiLCJkb20iLCJlbGVtZW50IiwiYWRkQ2xhc3MiLCJoZWFkZXIiLCJ0ciIsImsiLCJ0aCIsImFwcGVuZCIsImkiLCIkcm93IiwiaiIsIiRjb2wiLCJtb3ZlQ3Vyc29yVG9DZWwiLCJwb3NYIiwicG9zWSIsInNldFRpbWVvdXQiLCJmaXJzdENlbGwiLCJjZWxscyIsInJhbmdlIiwiY3JlYXRlUmFuZ2UiLCJtb3ZlVG9Qb3NpdGlvbiIsIlBPU0lUSU9OX0FGVEVSX1NUQVJUIiwic2VsZWN0IiwidXBkYXRlSGlkZGVuSGVhZGVyTGFiZWxzIiwiX3RhYmxlIiwiJHRhYmxlIiwiY29sdW1uVGgiLCJmaW5kIiwiZWFjaCIsIiR0aCIsImNvbHVtbkluZGV4IiwiaW5kZXgiLCIkY29scyIsImF0dHIiLCJ0ZXh0IiwidGl0bGUiLCJtaW5XaWR0aCIsIm1pbkhlaWdodCIsIm9uTG9hZCIsInNldHVwQ29udGVudCIsIm9uU2hvdyIsIm9uT2siLCJjb21taXRDb250ZW50IiwicGFyc2VJbnQiLCJ0eHRSb3dzIiwidHh0Q29scyIsImluc2VydEVsZW1lbnQiLCJvbiIsImUiLCJlbCIsImdldFNlbGVjdGlvbiIsImdldFN0YXJ0RWxlbWVudCIsInRhZ05hbWUiLCJnZXRQYXJlbnQiLCJoYXNDbGFzcyIsImNvbnRlbnRzIiwibGFiZWwiLCJleHBhbmQiLCJwYWRkaW5nIiwiZWxlbWVudHMiLCJ0eXBlIiwicmVxdWlyZWQiLCJzZXR1cCIsInNlbGVjdGVkRWxlbWVudCIsImNvbW1pdCIsInNlbGVjdGVkVGFibGUiLCJidXR0b25zIiwib2tCdXR0b24iXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7O0FB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O0FBU0VELGdCQUFRekU7QUFUVixPQXRCUTtBQU5aLEtBRFEsQ0EzQ0w7QUFzRkwyRSxhQUFTLENBQUNsRixTQUFTQyxNQUFULENBQWdCa0YsUUFBakI7QUF0RkosR0FBUDtBQXdGRCxDQS9MRCIsImZpbGUiOiJ0YWJsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGVcbiAqIFJlc3BvbnNpdmUgdGFibGUgcGx1Z2luLlxuICovXG5cbkNLRURJVE9SLmRpYWxvZy5hZGQoJ3RhYmxlX2RpYWxvZycsIGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgdmFyIGRpYWxvZztcbiAgdmFyICQgPSBqUXVlcnk7XG4gIHZhciB0YWJsZTtcblxuICAvKipcbiAgICogU3RvcmVzIHRoZSBkaWFsb2cgdXNlciBpbnB1dCBpbnRvIGFuIGFjY2Vzc2libGVcbiAgICogc2NvcGUgdG8gYWxsb3cgYWNjZXNzIHRvIHRoZSByZXN0IG9mIHRoZSBwbHVnaW4uXG4gICAqXG4gICAqIEBwYXJhbSBkYXRhXG4gICAqL1xuICB2YXIgY29tbWl0VmFsdWUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHZhciBpZCA9IHRoaXMuaWQ7XG5cbiAgICBpZiAoIWRhdGEuaW5mbykge1xuICAgICAgZGF0YS5pbmZvID0ge307XG4gICAgfVxuXG4gICAgZGF0YS5pbmZvW2lkXSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgfTtcblxuICAvKipcbiAgICogR2VuZXJhdGVzIHRoZSBET00gdGFibGUuXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSByb3dzXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBjb2xzXG4gICAqIEBwYXJhbSBzZXRIZWFkZXJcbiAgICpcbiAgICogQHJldHVybiB7Q0tFRElUT1IuZG9tLmVsZW1lbnR9XG4gICAqL1xuICBmdW5jdGlvbiBidWlsZFRhYmxlKHJvd3MsIGNvbHMsIHNldEhlYWRlcikge1xuICAgIHZhciB0YWJsZSA9IG5ldyBDS0VESVRPUi5kb20uZWxlbWVudChcInRhYmxlXCIpO1xuICAgIHRhYmxlLmFkZENsYXNzKCd0YWJsZScpO1xuICAgIHRhYmxlLmFkZENsYXNzKCdjay1yZXNwb25zaXZlLXRhYmxlJyk7XG4gICAgdGFibGUuYWRkQ2xhc3MoJ2NrZV9zaG93X2JvcmRlcicpO1xuXG4gICAgaWYgKHNldEhlYWRlciA9PT0gdHJ1ZSkge1xuICAgICAgdmFyIGhlYWRlciA9IG5ldyBDS0VESVRPUi5kb20uZWxlbWVudChcInRoZWFkXCIpO1xuICAgICAgdmFyIHRyID0gbmV3IENLRURJVE9SLmRvbS5lbGVtZW50KFwidHJcIik7XG5cbiAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgY29sczsgaysrKSB7XG4gICAgICAgIHZhciB0aCA9IG5ldyBDS0VESVRPUi5kb20uZWxlbWVudChcInRoXCIpO1xuICAgICAgICB0ci5hcHBlbmQodGgpO1xuICAgICAgfVxuXG4gICAgICBoZWFkZXIuYXBwZW5kKHRyKTtcbiAgICAgIHRhYmxlLmFwcGVuZChoZWFkZXIpO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm93czsgaSsrKSB7XG4gICAgICB2YXIgJHJvdyA9IG5ldyBDS0VESVRPUi5kb20uZWxlbWVudChcInRyXCIpO1xuXG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvbHM7IGorKykge1xuICAgICAgICB2YXIgJGNvbCA9IG5ldyBDS0VESVRPUi5kb20uZWxlbWVudChcInRkXCIpO1xuICAgICAgICAkcm93LmFwcGVuZCgkY29sKTtcbiAgICAgIH1cblxuICAgICAgdGFibGUuYXBwZW5kKCRyb3cpO1xuICAgIH1cblxuICAgIHJldHVybiB0YWJsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZG9jbWVcbiAgICpcbiAgICogQHBhcmFtIHBvc1hcbiAgICogQHBhcmFtIHBvc1lcbiAgICogQHBhcmFtIHRhYmxlXG4gICAqL1xuICBmdW5jdGlvbiBtb3ZlQ3Vyc29yVG9DZWwocG9zWCwgcG9zWSwgdGFibGUpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBmaXJzdENlbGwgPSBuZXcgQ0tFRElUT1IuZG9tLmVsZW1lbnQodGFibGUuJC5yb3dzW3Bvc1hdLmNlbGxzW3Bvc1ldKTtcbiAgICAgIHZhciByYW5nZSA9IGVkaXRvci5jcmVhdGVSYW5nZSgpO1xuICAgICAgcmFuZ2UubW92ZVRvUG9zaXRpb24oZmlyc3RDZWxsLCBDS0VESVRPUi5QT1NJVElPTl9BRlRFUl9TVEFSVCk7XG4gICAgICByYW5nZS5zZWxlY3QoKTtcbiAgICB9LCAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZG9jbWVcbiAgICpcbiAgICogQHBhcmFtIF90YWJsZSBDa2VkaXRvcidzIHRhYmxlIGVsZW1lbnQuXG4gICAqL1xuICBmdW5jdGlvbiB1cGRhdGVIaWRkZW5IZWFkZXJMYWJlbHMoX3RhYmxlKSB7XG4gICAgdmFyICR0YWJsZSA9ICQoX3RhYmxlLiQpO1xuICAgIHZhciBjb2x1bW5UaCA9ICR0YWJsZS5maW5kKFwidGhlYWQgdGhcIik7XG5cbiAgICBjb2x1bW5UaC5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciAkdGggPSAkKHRoaXMpO1xuICAgICAgdmFyIGNvbHVtbkluZGV4ID0gJCh0aGlzKS5pbmRleCgpICsgMTtcbiAgICAgIHZhciAkY29scyA9ICR0YWJsZS5maW5kKCd0ciB0ZDpudGgtY2hpbGQoJyArIGNvbHVtbkluZGV4ICsgJyknKTtcblxuICAgICAgJGNvbHMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkY29sID0gJCh0aGlzKTtcbiAgICAgICAgJGNvbC5hdHRyKCdkYXRhLWxhYmVsJywgJHRoLnRleHQoKSk7XG4gICAgICB9KTtcblxuICAgIH0pO1xuXG4gIH1cblxuICAvLyBEaWFsb2cuXG4gIHJldHVybiB7XG4gICAgdGl0bGU6IFwiQWRkIHRhYmxlXCIsXG4gICAgbWluV2lkdGg6IDM2MCxcbiAgICBtaW5IZWlnaHQ6IDMyMCxcblxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgZGlhbG9nID0gdGhpcztcbiAgICAgIHRoaXMuc2V0dXBDb250ZW50KCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEB0b2RvIHJlbW92ZSB0aGlzIG1ldGhvZC5cbiAgICAgKi9cbiAgICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogV2hlbiBjb25maXJtIHRoZSBkaWFsb2cuXG4gICAgICovXG4gICAgb25PazogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgIHRoaXMuY29tbWl0Q29udGVudChkYXRhKTtcbiAgICAgIHZhciBpbmZvID0gZGF0YS5pbmZvO1xuICAgICAgdmFyIHJvd3MgPSBwYXJzZUludChpbmZvLnR4dFJvd3MsIDEwKSB8fCAxO1xuICAgICAgdmFyIGNvbHMgPSBwYXJzZUludChpbmZvLnR4dENvbHMsIDEwKSB8fCAxO1xuICAgICAgdGFibGUgPSBidWlsZFRhYmxlKHJvd3MsIGNvbHMsIGluZm8uc2V0SGVhZGVyKTtcbiAgICAgIGVkaXRvci5pbnNlcnRFbGVtZW50KHRhYmxlKTtcbiAgICAgIG1vdmVDdXJzb3JUb0NlbCgwLCAwLCB0YWJsZSk7XG5cblxuICAgICAgZWRpdG9yLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgZWwgPSBlZGl0b3IuZ2V0U2VsZWN0aW9uKCkuZ2V0U3RhcnRFbGVtZW50KCk7XG5cbiAgICAgICAgaWYgKGVsICE9PSBudWxsICYmIGVsLiQudGFnTmFtZSA9PT0gXCJUSFwiKSB7XG4gICAgICAgICAgdmFyIF90YWJsZSA9IGVsLmdldFBhcmVudCgpLmdldFBhcmVudCgpLmdldFBhcmVudCgpO1xuICAgICAgICAgIGlmIChfdGFibGUuaGFzQ2xhc3MoJ2NrLXJlc3BvbnNpdmUtdGFibGUnKSkge1xuICAgICAgICAgICAgdXBkYXRlSGlkZGVuSGVhZGVyTGFiZWxzKF90YWJsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBjb250ZW50czogW1xuICAgICAge1xuICAgICAgICBpZDogJ3RhYjEnLFxuICAgICAgICBsYWJlbDogJycsXG4gICAgICAgIHRpdGxlOiAnJyxcbiAgICAgICAgZXhwYW5kOiB0cnVlLFxuICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICBlbGVtZW50czogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIGlkOiAndHh0Um93cycsXG4gICAgICAgICAgICAnZGVmYXVsdCc6IDMsXG4gICAgICAgICAgICBsYWJlbDogXCJSb3dzXCIsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbiAoc2VsZWN0ZWRFbGVtZW50KSB7XG4gICAgICAgICAgICAgIC8vIHRoaXMuc2V0VmFsdWUoc2VsZWN0ZWRFbGVtZW50LiQucm93cy5sZW5ndGgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbW1pdDogY29tbWl0VmFsdWVcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICBpZDogJ3R4dENvbHMnLFxuICAgICAgICAgICAgJ2RlZmF1bHQnOiAyLFxuICAgICAgICAgICAgbGFiZWw6IFwiQ29sdW1uc1wiLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24gKHNlbGVjdGVkVGFibGUpIHtcbiAgICAgICAgICAgICAgLy8gdGhpcy5zZXRWYWx1ZSh0YWJsZUNvbHVtbnMoc2VsZWN0ZWRUYWJsZSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbW1pdDogY29tbWl0VmFsdWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsXG4gICAgICAgICAgICBpZDogJ3NldEhlYWRlcicsXG4gICAgICAgICAgICAnZGVmYXVsdCc6IDAsXG4gICAgICAgICAgICBsYWJlbDogXCJBZGQgYSBoZWFkZXJcIixcbiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbiAoc2VsZWN0ZWRUYWJsZSkge1xuICAgICAgICAgICAgICAvLyB0aGlzLnNldFZhbHVlKHRhYmxlQ29sdW1ucyhzZWxlY3RlZFRhYmxlKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tbWl0OiBjb21taXRWYWx1ZVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIF0sXG4gICAgYnV0dG9uczogW0NLRURJVE9SLmRpYWxvZy5va0J1dHRvbl1cbiAgfTtcbn0pO1xuIl19"}